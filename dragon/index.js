!function(){void 0===window.Gama&&(window.Gama={}),window.Gama.Skeleton=function t(e,n,s){function r(i,a){if(!n[i]){if(!e[i]){var u="function"==typeof require&&require;if(!a&&u)return u(i,!0);if(o)return o(i,!0);var p=new Error("Cannot find module '"+i+"'");throw p.code="MODULE_NOT_FOUND",p}var l=n[i]={exports:{}};e[i][0].call(l.exports,function(t){var n=e[i][1][t];return r(n?n:t)},l,l.exports,t,e,n,s)}return n[i].exports}for(var o="function"==typeof require&&require,i=0;i<s.length;i++)r(s[i]);return r}({1:[function(t,e,n){e.exports=t("./lib/skeleton.js")},{"./lib/skeleton.js":2}],2:[function(t,e,n){function s(t,e){this.ele=new r(t),this.image=e.image,this.tpJSON=e.tpJSON,this.skJSON=e.skJSON,this.scale=e.scale||1,this.initRoot(),this.initStruct()}var r=t("@ali/gama-node"),o=t("@ali/gama-domino"),i=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)}}();s.prototype.normalizeTransform=function(t){t.x=t.x*this.scale||0,t.y=t.y*this.scale||0,t.skX=t.skX||0,t.skY=t.skY||0},s.prototype.initRoot=function(){var t=this.skJSON.armature[0];if(this.bone={},this.slot={},this.skins=[],this.animation={},t){this.bone.root=t.bone.filter(function(t){return"root"===t.name})[0],this.normalizeTransform(this.bone.root.transform),t.bone.forEach(function(t){t.children=[],t.slot=[]});for(var e;t.bone.length>0;){e=t.bone.shift();var n=e.parent;void 0!=n&&(this.bone[n]?(this.bone[e.name]=e,e.parent=this.bone[n],this.normalizeTransform(e.transform),this.bone[n].children.push(e)):t.bone.push(e))}for(;t.slot.length>0;){var s=t.slot.pop(),n=s.parent;this.bone[n]&&(s.parent=this.bone[n],s.skins=[],this.bone[n].slot.push(s),this.slot[s.name]=s)}for(;t.skin[0].slot.length>0;){var r=t.skin[0].slot.shift();this.slot[r.name]&&(r.parent=this.slot[r.name],this.slot[r.name].skins.push(r))}for(;t.animation.length>0;){var o=t.animation.pop(),i=o.bone;for(o.bone={};i.length>0;){for(var a=i.pop(),u=0;u<a.frame.length;u++)this.normalizeTransform(a.frame[u].transform);o.bone[a.name]=a}this.animation[o.name]=o}}},s.prototype.updateSlotStatus=function(t,e){for(var n=[],s=t;s;)n.push(s),s=s.parent;for(t.domino.setTranslation(0,0);n.length>0;){var r=n.pop();if(r.transform){var o=r.transform;e&&r.animTransform&&(o=r.animTransform),t.domino.translate(o.x||0,o.y||0).rotate(o.skX/180*Math.PI||0)}}},s.prototype.initStruct=function(){for(var t in this.slot)if(this.slot.hasOwnProperty(t)){var e=this.slot[t],n=r.create("div");e.div=n,this.ele.append(n),n.width(0).height(0).css({position:"absolute",zIndex:e.z||0}),e.domino=new o(n.ele),this.updateSlotStatus(e);for(var s=0;s<e.skins.length;s++){var i=e.skins[s];i.divs=[];for(var a=0;a<i.display.length;a++){var u=r.create("div");i.parent.div.append(u);var p=i.display[a];this.normalizeTransform(p.transform),p.name=p.name.substr(p.name.lastIndexOf("/")+1);var l=this.tpJSON.frames[p.name+".png"].frame,c=this.tpJSON.meta.width,h=this.tpJSON.meta.height,f=this.scale,m=l.w*f,d=l.h*f;u.width(m).height(d).css({position:"absolute",backgroundImage:"url("+(this.image.src||this.image)+")",backgroundPosition:l.x*f+"px "+l.y*f+"px",backgroundSize:c*f+"px "+h*f+"px",marginLeft:-m/2+"px",marginTop:-d/2+"px"});var y=p.transform,v=new o(u.ele);v.translate(y.x,y.y).rotate(y.skX/180*Math.PI)}}}},s.prototype.play=function(t,e){function n(){var t=Date.now(),u=(t-r)/s%o.duration;for(var p in o.bone)for(var l=o.bone[p].frame,c=u,h=0;h<l.length;h++){if(!(c>l[h].duration)){var f=l[h],m=l[h+1],d=c/f.duration;a.bone[p].animTransform={x:(1-d)*f.transform.x+d*m.transform.x+a.bone[p].transform.x,y:(1-d)*f.transform.y+d*m.transform.y+a.bone[p].transform.y,skX:(1-d)*f.transform.skX+d*m.transform.skX+a.bone[p].transform.skX,skY:(1-d)*f.transform.skY+d*m.transform.skY+a.bone[p].transform.skY};var y=a.bone[p].animTransform;isNaN(y.x)||isNaN(y.y)||isNaN(y.skX)||isNaN(y.skY);break}c-=l[h].duration}a.update(),a.toStop?(a.isPlaying=!1,a.toStop=!1,e.callback&&e.callback(),a.onStop&&a.onStop()):i(n)}if(this.isPlaying)return this.onStop=this.play.bind(this,t,e),void this.stop();e=e||{};var s=1e3/24;e.fps?s=1e3/e.fps:e.interval&&(s=e.interval);var r=Date.now(),o=this.animation[t],a=this;this.isPlaying=!0,n()},s.prototype.stop=function(){this.toStop=!0},s.prototype.update=function(){for(var t in this.slot)this.slot.hasOwnProperty(t)&&this.updateSlotStatus(this.slot[t],!0)},e.exports=s},{"@ali/gama-domino":3,"@ali/gama-node":20}],3:[function(t,e,n){e.exports=t("./src/domino.js")},{"./src/domino.js":19}],4:[function(t,e,n){e.exports=t("./src/node.js")},{"./src/node.js":11}],5:[function(t,e,n){n.mix=function(t){t.create=function(e){try{return new t(document.createElement(e||"div"))}catch(n){return null}},t.prototype.clone=function(){return new t(this.ele.cloneNode(!0))},t.prototype.append=function(t){return this.ele.appendChild(t.ele),this},t.prototype.clear=function(){return this.ele.innerHTML="",this},t.prototype.remove=function(){var t=this.ele.parentNode;return t.removeChild(this.ele),this},t.prototype.equal=function(t){return this.ele===t.ele},t.prototype.bind=function(t,e){if(this.ele.addEventListener)this.ele.addEventListener(t,e);else{if(!this.ele.attachEvent)throw"没有响应DOM事件的方法";this.ele.attachEvent("on"+t,e)}return this}}},{}],6:[function(t,e,n){n.mix=function(t){t.prototype.hasClass=function(t){if(this.ele.classList)return this.ele.classList.contains(t);var e=new RegExp("(\\s|^)"+t+"(\\s|$)"),n=this.ele.className.search(e);return-1!==n},t.prototype.addClass=function(t){return this.ele.classList?this.ele.classList.add(t):this.hasClass(t)||(this.ele.className+=" "+t),this},t.prototype.removeClass=function(t){if(this.ele.classList)this.ele.classList.remove(t);else{var e=new RegExp("(\\s|^)"+t+"(\\s|$)");this.ele.className=this.ele.className.replace(e," ")}}}},{}],7:[function(t,e,n){n.mix=function(t){function e(t,e){return window.getComputedStyle?window.getComputedStyle(t.ele)[e]:t.ele.currentStyle?t.ele.currentStyle[e]:""}var n=t.utils.inDocument,s=t.utils.createInvisibleCloneNode;t.prototype.css=function(r,o){if("object"!=typeof r){if(void 0===o){if(n(this))return e(this,r);var i=s(this,"left"===r),a=e(i,r);return i.remove(),a}try{this.ele.style[r]=o}catch(u){}return this}for(var p in r)r.hasOwnProperty(p)&&t.prototype.css.call(this,p,r[p])};var r=["webkit","moz","ms"];t.prototype.cssInspect=function(t,e){if(t in this.ele.style)return t;for(var n=t.toUpperCase()[0]+t.substr(1),s=0;s<r.length;s++)if(r[s]+n in this.ele.style)return e?"-"+r[s]+"-"+t:r[s]+n;return null}}},{}],8:[function(t,e,n){n.mix=function(t){function e(t,e){t.css("width",e+"px")}function n(t,e){t.css("height",e+"px")}function s(t){var e=t.ele.offsetWidth;return e?e:o(t,"width")}function r(t){var e=t.ele.offsetHeight;return e?e:o(t,"height")}var o=t.utils.cssNumber;t.prototype.width=function(t){return void 0===t?s(this):(e(this,t),this)},t.prototype.height=function(t){return void 0===t?r(this):(n(this,t),this)},t.prototype.offset=function(t){for(var e=0,n=0,s=this.container;null!==s;s=s.offsetParent)e+=s.offsetLeft,n+=s.offsetTop;if(!t)return{x:e,y:n};var r=document.body.scrollLeft||document.documentElement.scrollLeft||window.pageXOffset||0,o=document.body.scrollTop||document.documentElement.scrollTop||window.pageYOffset||0;return e-=r,n-=o,{x:e,y:n}}}},{}],9:[function(t,e,n){n.mix=function(t){var e=function(){function e(){r=function(t,e,n){9===t.length&&void 0===e&&void 0===n&&(e=t[5],t=t[2]),void 0===this._transform_x&&(this._transform_x=parseInt(this.css("left"))||0,this._transform_y=parseInt(this.css("top"))||0),this.css("left",this._transform_x+t+"px"),this.css("top",this._transform_y+e+"px")}}function n(t){r=function(e,n,s){if(void 0!==n&&void 0!==s){var r="translate3d("+e+"px,"+n+"px, 0)";r+=" rotate("+180*s/Math.PI+"deg)",this.css(t,r)}else{var o=[e[0],e[3],0,e[6],e[1],e[4],0,e[7],0,0,1,0,e[2],e[5],0,e[8]],i="matrix3d("+o.join(",")+")";this.css(t,i)}}}function s(t){r=function(e,n,s){if(void 0!==n&&void 0!==s){var r="translate("+e+"px,"+n+"px)";r+=" rotate("+180*s/Math.PI+"deg)",this.css(t,r)}else{var o=[e[0],e[3],e[1],e[4],e[2],e[5]],i="matrix("+o.join(",")+")";this.css(t,i)}}}var r;return function(){if(r)return r;if(window.document.body){var o=new t(window.document.body),i=o.cssInspect("transform");if(i){var a=function(){var e=t.create();o.append(e),e.css(i,"translateZ(0)");var n=e.css(i);return e.remove(),n&&"none"!==n}();a?n(i):s(i)}else e();return r}return function(){}}}();t.prototype.setTransform=function(){e().apply(this,arguments)}}},{}],10:[function(t,e,n){e.exports.mix=function(t){t.utils={},t.utils.inDocument=function(t){var e=window.document.body;if(e.contains)return e.contains(t.ele);if(e.compareDocumentPosition){var n=e.compareDocumentPosition(t.ele);return 0===(1&n)}throw"无法获取判断节点是否在文档的方法"},t.utils.createInvisibleCloneNode=function(e,n){var s=window.document.body,r=n?"top":"left",o=new t(e.ele.cloneNode(!0)).css("display","block").css("position","absolute").css(r,"-9999px");return new t(s).append(o),o},t.utils.cssNumber=function(t,e){return parseInt(t.css(e))||0}}},{}],11:[function(t,e,n){function s(t){return this instanceof s?void(this.ele=t):new s(t)}var r=t("./node-base.js"),o=t("./node-css.js"),i=t("./node-size.js"),a=t("./node-class.js"),u=t("./node-transform.js"),p=t("./node-utils.js");p.mix(s),r.mix(s),o.mix(s),i.mix(s),a.mix(s),u.mix(s),s.utils=void 0,e.exports=s},{"./node-base.js":5,"./node-class.js":6,"./node-css.js":7,"./node-size.js":8,"./node-transform.js":9,"./node-utils.js":10}],12:[function(t,e,n){e.exports=t("./src/transformable.js")},{"./src/transformable.js":18}],13:[function(t,e,n){e.exports=t("./src/event.js")},{"./src/event.js":14}],14:[function(t,e,n){var s={mix:function(t){for(var e in r)t.prototype[e]=r[e];return this}},r={on:function(t,e){return this.events=this.events||{},this.events[t]=this.events[t]||[],-1===this.events[t].indexOf(e)&&this.events[t].push(e),this},off:function(t,e){if(this.events&&this.events[t]){var n=this.events[t].indexOf(e);-1!==n&&this.events[t].splice(n,1)}return this},fire:function(t,e){if(this.events&&this.events[t])for(var n=this.events[t],s=0;s<n.length;s++)n[s].call(this,e);return this}};e.exports=s},{}],15:[function(t,e,n){e.exports={Matrix3:t("./src/matrix3.js"),Vector3:t("./src/vector3.js")}},{"./src/matrix3.js":16,"./src/vector3.js":17}],16:[function(t,e,n){function s(){this.eles=[],this.identify()}function r(t,e){return{e11:t.e11*e.e11+t.e12*e.e21+t.e13*e.e31,e12:t.e11*e.e12+t.e12*e.e22+t.e13*e.e32,e13:t.e11*e.e13+t.e12*e.e23+t.e13*e.e33,e21:t.e21*e.e11+t.e22*e.e21+t.e23*e.e31,e22:t.e21*e.e12+t.e22*e.e22+t.e23*e.e32,e23:t.e21*e.e13+t.e22*e.e23+t.e23*e.e33,e31:t.e31*e.e11+t.e32*e.e21+t.e33*e.e31,e32:t.e31*e.e12+t.e32*e.e22+t.e33*e.e32,e33:t.e31*e.e13+t.e32*e.e23+t.e33*e.e33}}s.prototype.set=function(t){for(var e=0;9>e;e++)this.eles[e]=t[e];return this},s.prototype.get=function(t){return t?this.eles:this.eles.slice()},s.prototype.scatter=function(){var t=this.eles;return{e11:t[0],e12:t[1],e13:t[2],e21:t[3],e22:t[4],e23:t[5],e31:t[6],e32:t[7],e33:t[8]}},s.prototype.gather=function(t){var e=t;return this.set([e.e11,e.e12,e.e13,e.e21,e.e22,e.e23,e.e31,e.e32,e.e33])};var o=[1,0,0,0,1,0,0,0,1];s.prototype.identify=function(){return this.set(o)},s.prototype.add=function(t){for(var e=this.eles,n=t.eles,s=0;s<e.length;s++)e[s]+=n[s];return this},s.prototype.sub=function(t){for(var e=this.eles,n=t.eles,s=0;s<e.length;s++)e[s]-=n[s];return this},s.prototype.multiply=function(t){var e=r(this.scatter(),t.scatter());return this.gather(e)},s.prototype.multiplyBy=function(t){var e=r(t.scatter(),this.scatter());return this.gather(e)},s.prototype.transpose=function(){var t=this.eles,e=[];return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this.set(e)},s.prototype.det=function(){var t=this.scatter(),e=t.e11*t.e22*t.e33+t.e21*t.e32*t.e13+t.e31*t.e12*t.e23-t.e11*t.e32*t.e23-t.e31*t.e22*t.e13-t.e21*t.e12*t.e33;return e},s.prototype.inverse=function(){var t=this.det();if(0===t)return this.identify();var e=this.scatter(),n={e11:(e.e22*e.e33-e.e23*e.e32)/t,e12:(e.e13*e.e32-e.e12*e.e33)/t,e13:(e.e12*e.e23-e.e13*e.e22)/t,e21:(e.e23*e.e31-e.e21*e.e33)/t,e22:(e.e11*e.e33-e.e13*e.e31)/t,e23:(e.e13*e.e21-e.e11*e.e23)/t,e31:(e.e21*e.e32-e.e22*e.e31)/t,e32:(e.e12*e.e31-e.e11*e.e32)/t,e33:(e.e11*e.e22-e.e12*e.e21)/t};return this.gather(n)},s.prototype.setTranslation=function(t,e){return this.set([1,0,t,0,1,e,0,0,1])},s.prototype.setRotation=function(t){return this.set([Math.cos(t),-Math.sin(t),0,Math.sin(t),Math.cos(t),0,0,0,1])},s.prototype.setScale=function(t,e){return this.set([t,0,0,0,e,0,0,0,1])},s.prototype.setSkewX=function(t){return this.set([1,t,-t,0,1,0,0,0,1])},s.prototype.setSkewY=function(t){return this.set([1,0,0,t,1,-t,0,0,1])},s.prototype.decompose=function(){var t=this.eles,e=t[0],n=t[1],s=t[2],r=t[3],o=t[4],i=t[5];return{translation:[s,i],rotation:Math.atan2(r,o),scale:[Math.sqrt(e*e+n*n),Math.sqrt(r*r+o*o)]}},s.prototype.equal=function(t){for(var e=this.eles,n=t.eles,s=0;s<e.length;s++)if(e[s]!==n[s])return!1;return!0},s.prototype.copyFrom=function(t){return this.set(t.eles)},s.prototype.clone=function(){return(new s).set(this.eles)},s.multiply=function(t,e){return t.clone().multiply(e)},s.add=function(t,e){return t.clone().add(e)},s.sub=function(t,e){return t.clone().sub(e)},e.exports=s},{}],17:[function(t,e,n){function s(){this.eles=[0,0,1]}s.prototype.set=function(t){for(var e=0;3>e;e++)this.eles[e]=t[e];return this},s.prototype.setPosition=function(t,e){return this.set([t,e,1])},s.prototype.setDirection=function(t,e){return this.set([t,e,0])},s.prototype.isPosition=function(){return 1===this.eles[2]},s.prototype.isDirection=function(){return 0===this.eles[2]},s.prototype.getPosition=function(){return[this.eles[0],this.eles[1]]},s.prototype.getDirection=function(){return[this.eles[0],this.eles[1]]},s.prototype.add=function(t){return t.isDirection()&&(this.eles[0]+=t.eles[0],this.eles[1]+=t.eles[1]),this},s.prototype.sub=function(t){var e=this.eles,n=t.eles;return this.isPosition()?(e[0]-=n[0],e[1]-=n[1],e[2]-=n[2]):this.isDirection()&&t.isDirection()&&(e[0]-=n[0],e[1]-=n[1]),this},s.prototype.length=function(){var t=this.eles;return Math.sqrt(t[0]*t[0]+t[1]*t[1])},s.prototype.normalize=function(){var t=this.length();this.eles[0]/=t,this.eles[1]/=t},s.prototype.multiplyByMatrix3=function(t){var e=this.eles,n=e[0],s=e[1],r=e[2],o=t.eles;return e[0]=o[0]*n+o[1]*s+o[2]*r,e[1]=o[3]*n+o[4]*s+o[5]*r,e[2]=o[6]*n+o[7]*s+o[8]*r,this},s.prototype.dot=function(t){if(this.isDirection()&&t.isDirection()){var e=this.eles,n=t.eles;return e[0]*n[0]+e[1]*n[1]}return NaN},s.prototype.clone=function(){return new s(this.eles)},s.prototype.copyFrom=function(t){return this.set(t.eles)},e.exports=s},{}],18:[function(t,e,n){function s(){this.matrix=new o,this.saves=[]}e.exports=s;var r=t("@ali/gama-math"),o=r.Matrix3,i=r.Vector3,a=t("@ali/gama-event");s.Related={Math:r},a.mix(s),s.prototype.save=function(){return this.saves.push(this.matrix.clone()),this},s.prototype.restore=function(){return this.matrix=this.saves.pop(),this.fire("transform"),this},s.prototype.setTranslation=function(t,e){return this.matrix.setTranslation(t,e),this.fire("transform"),this},s.prototype.setTranslationX=function(t){return this.setTranslation(t,0)},s.prototype.setTranslationY=function(t){return this.setTranslation(0,t)},s.prototype.translate=function(t,e){var n=(new o).setTranslation(t,e);return this.matrix.multiply(n),this.fire("transform"),this},s.prototype.translateX=function(t){return this.translate(t,0)},s.prototype.translateY=function(t){return this.translate(0,t)},s.prototype.translateGlobally=function(t,e){var n=(new o).setTranslation(t,e);return this.matrix.multiplyBy(n),this.fire("transform"),this},s.prototype.translateXGlobally=function(t){return this.translateGlobally(t,0)},s.prototype.translateYGlobally=function(t){return this.translateGlobally(0,t)},s.prototype.setRotation=function(t){return this.matrix.setRotation(t),this.fire("transform"),this},s.prototype.rotate=function(t){var e=(new o).setRotation(t);return this.matrix.multiply(e),this.fire("transform"),this},s.prototype.rotateGlobally=function(t){var e=(new o).setRotation(t);return this.matrix.multiplyBy(e),this.fire("transform"),this},s.prototype.setScale=function(t,e){return this.matrix.setScale(t,e),this.fire("transform"),this},s.prototype.setScaleX=function(t){return this.setScale(t,1)},s.prototype.setScaleY=function(t){return this.setScale(1,t)},s.prototype.scale=function(t,e){void 0===e&&(e=t);var n=(new o).setScale(t,e);return this.matrix.multiply(n),this.fire("transform"),this},s.prototype.scaleX=function(t){return this.scale(t,1)},s.prototype.scaleY=function(t){return this.scale(1,t)},s.prototype.setSkewX=function(t){var e=Math.tan(t);return this.matrix.setSkewX(e),this.fire("transform"),this},s.prototype.setSkewY=function(t){var e=Math.tan(t);return this.matrix.setSkewY(e),this.fire("transform"),this},s.prototype.skewX=function(t){var e=Math.tan(t),n=(new o).setSkewX(e);return this.matrix.multiply(n),this.fire("transform"),this},s.prototype.skewY=function(t){var e=Math.tan(t),n=(new o).setSkewY(e);return this.matrix.multiply(n),this.fire("transform"),this},s.prototype.getPosition=function(){return this.matrix.decompose().translation},s.prototype.getRotation=function(){return this.matrix.decompose().rotation},s.prototype.getScale=function(){return this.matrix.decompose().scale},s.prototype.getOrientation=function(t,e){t||e||(t=1,e=0);var n=new i;return n.setDirection(t,e),n.multiplyByMatrix3(this.matrix),n.normalize(),n.getDirection()},s.prototype.getDistanceWith=function(t){var e=this.getPosition(),n=t.getPosition(),s=(new i).setPosition(e[0],n[1]),r=(new i).setPosition(n[0],n[1]);return s.sub(r).length()}},{"@ali/gama-event":13,"@ali/gama-math":15}],19:[function(t,e,n){function s(t){o.call(this),this.node=new r(t),this.on("transform",function(){this.updateNode()}.bind(this))}e.exports=s;var r=t("@ali/gama-node"),o=t("@ali/gama-transformable");s.prototype=Object.create(o.prototype),s.prototype.updateNode=function(){this.node.setTransform(this.matrix.eles)},s.prototype.enableTransition=function(t){t=t||500;var e=this.node.cssInspect("transition"),n=this.node.cssInspect("transform",!0);this.node.css(e,n+" "+t+"ms ease")},s.prototype.disableTransition=function(){var t=this.node.cssInspect("transition");this.node.css(t,"none")}},{"@ali/gama-node":4,"@ali/gama-transformable":12}],20:[function(t,e,n){arguments[4][4][0].apply(n,arguments)},{"./src/node.js":27,dup:4}],21:[function(t,e,n){arguments[4][5][0].apply(n,arguments)},{dup:5}],22:[function(t,e,n){arguments[4][6][0].apply(n,arguments)},{dup:6}],23:[function(t,e,n){arguments[4][7][0].apply(n,arguments)},{dup:7}],24:[function(t,e,n){arguments[4][8][0].apply(n,arguments)},{dup:8}],25:[function(t,e,n){arguments[4][9][0].apply(n,arguments)},{dup:9}],26:[function(t,e,n){arguments[4][10][0].apply(n,arguments)},{dup:10}],27:[function(t,e,n){arguments[4][11][0].apply(n,arguments)},{"./node-base.js":21,"./node-class.js":22,"./node-css.js":23,"./node-size.js":24,"./node-transform.js":25,"./node-utils.js":26,dup:11}]},{},[1])(1)}();